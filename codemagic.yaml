workflows:
  ios-unsigned:
    name: Unsigned iOS Build (AltStore)
    environment:
      flutter: stable
      xcode: latest
    scripts:
      - name: Fix and Build
        script: |
          set -e
          
          echo "ğŸ”„ Fixing dependency version..."
          
          # Simple fix - directly update the version
          # The error says 2.3.0 doesn't exist, and suggests 1.1.0
          sed -i.bak 's|code_text_field: \^2\.3\.0|code_text_field: ^1.1.0|g' pubspec.yaml
          
          echo "ğŸ“¦ Getting packages..."
          flutter pub get
          
          echo "ğŸ—ï¸ Building iOS app..."
          flutter build ios --release --no-codesign
          
          echo "ğŸ“¦ Packaging IPA..."
          cd build/ios/iphoneos
          mkdir -p Payload
          mv Runner.app Payload
          zip -qr app.ipa Payload
          
          echo "âœ… Build completed successfully!"
          
    artifacts:
      - build/ios/iphoneos/*.ipa